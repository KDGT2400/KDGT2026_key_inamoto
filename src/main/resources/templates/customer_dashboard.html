<!DOCTYPE html>
<html lang="ja"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
  <meta charset="UTF-8">
  <title>リマインダー一覧</title>
  <link rel="stylesheet" th:href="@{/css/style.css}">
  <style>
  :root {
    --bg-color: [[${user.backgroundColor}]];
    --text-color: [[${user.textColor}]];
    --font-size: [[${user.fontSize}]];
  }

  body {
    background-color: var(--bg-color);
    color: var(--text-color);
    font-size: var(--font-size);
  }
  </style>
</head>

<body>

<header class="header">
  <h1>リマインダー一覧</h1>
  <p>
    ようこそ、<span sec:authentication="name"></span> さん
  </p>
</header>

<nav class="main-nav">
  <a th:href="@{/reminder/new}" class="button">リマインダー登録</a>
  <a th:href="@{/calendar}" class="button">カレンダー</a>

  <form th:action="@{/logout}" method="post" class="inline">
    <button type="submit" class="button secondary">ログアウト</button>
    <input type="hidden"
           th:name="${_csrf.parameterName}"
           th:value="${_csrf.token}">
  </form>
</nav>

<main class="container">

  <h2>あなたのリマインダー</h2>
  
  <form method="get" th:action="@{/dashboard}" class="month-selector">
    <select name="year">
      <option th:each="y : ${#numbers.sequence(2026, 2030)}"
              th:value="${y}"
              th:selected="${y == year}"
              th:text="${y + '年'}">
      </option>
    </select>

    <select name="month">
      <option th:each="m : ${#numbers.sequence(1,12)}"
              th:value="${m}"
              th:selected="${m == month}"
              th:text="${m + '月'}">
      </option>
    </select>

    <button type="submit" class="btn">表示</button>
  </form>


  <!-- リマインダーがない場合 -->
  <p th:if="${#lists.isEmpty(reminders)}">
    リマインダーはありません。
  </p>

  <!-- リマインダーがある場合 -->
  <table th:if="${!#lists.isEmpty(reminders)}">
    <thead>
      <tr>
        <th>内容</th>
        <th>通知日時</th>
        <th>状態</th>
		<th>　</th>
      </tr>
    </thead>

	<tbody>
		<tr th:each="reminder : ${reminders}"
		    th:classappend="${reminder.date.isBefore(T(java.time.LocalDate).now())} ? 'past-reminder'">
	    <!-- 内容 -->
	    <td th:text="${reminder.title}"></td>

	    <!-- 通知日時 -->
	    <td>
	      <span th:text="${reminder.date}"></span>
	      <span th:if="${reminder.time != null}"
	            th:text="${reminder.time}"></span>
	    </td>

	    <!-- 状態 -->
	    <td th:text="${reminder.notified ? '通知済み' : '未通知'}"></td>

	    <!-- 操作（← tdはこれ1つだけ） -->
	    <td class="actions-cell">
	      <!-- 編集 -->
	      <a th:href="@{/reminder/{id}/edit(id=${reminder.id})}"
	         class="btn edit">
	        編集
	      </a>

	      <!-- 削除 -->
	      <form th:action="@{/reminder/{id}/delete(id=${reminder.id})}"
	            method="post">
	        <input type="hidden"
	               th:name="${_csrf.parameterName}"
	               th:value="${_csrf.token}">
	        <button type="submit"
	                class="btn delete"
	                onclick="return confirm('削除しますか？')">
	          削除
	        </button>
	      </form>
	    </td>
	  </tr>
	</tbody>

  </table>

</main>

<script th:inline="javascript">
    const layout = /*[[${layoutJson}]]*/ '{}';
	const root = document.documentElement;
	    root.style.setProperty('--bg-color', layout.backgroundColor ?? '#fff');
	    root.style.setProperty('--text-color', layout.textColor ?? '#000');
	    root.style.setProperty('--font-size', layout.fontSize ?? '16px');
</script>

</body>
</html>
